@model Company
@inject SignInManager<AppUser> SignInManager
@using Microsoft.AspNetCore.Identity
@using RecruitmentApp.Models
@inject UserManager<AppUser> UserManager
@inject AppDbContext appDbContext
@{
    ViewData["Title"] = "Home Page";
    //  background-image: url("~/files/background_view_company.jpg");
}

<style>
    .background-img {
    }

    .ilabel:after {
        content: "";
        width: 0;
        height: 0;
        border-top: 1rem solid #9e2e38;
        border-right: 1rem solid transparent;
        position: absolute;
        top: 100%;
        right: 0px;
    }

</style>
@section Search  {
    <div class="container-fluid py-2" style="background: #f5f3ff;">

        <div class="container">
            <div class="row justify-content-between align-items-center ">
                <div class="col-sm-2">
                    <img class="w-100" src="~/company-logo/@Model.LogoImage" />
                </div>
                <div class="col-sm-8">
                    <h4>@Model.Name</h4>
                    <div class="row justify-content-between align-items-center ">


                        <div class="p-2">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-map-marker-alt mr-2"></i>
                                @if (Model.Addresses.Any())
                                {
                                    List<string> listAddresses = new List<string>();
                                    foreach (var address in Model.Addresses)
                                    {
                                        listAddresses.Add(address.City.FullName);
                                    }
                                    if (listAddresses.Count > 0)
                                    {
                                        @string.Join(" - ", listAddresses)
                                    }
                                    else
                                    {
                                        listAddresses.First().ToString();
                                    }
                                }

                            </div>
                            <div class="d-flex align-items-center">

                                <i class="fas fa-globe mr-2"></i>
                                <a asp-action="">

                                    @Model.CompanyUrl
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                            <div class="d-flex align-items-center">

                                <i class="fab fa-facebook mr-2"></i>
                                <a asp-action="">

                                    @Model.CompanyUrl
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 flex-column">
                    @{
                        var follower = appDbContext.Followers.FirstOrDefault(e => e.CompanyID == @Model.CompanyId && e.UserID == @UserManager.GetUserId(User));
                    }
                    @if (follower != null)
                    {
                        <form method="POST" asp-action="UnFollow" asp-area="Companies" asp-controller="Company">
                            <input type="hidden" name="UserId" value="@UserManager.GetUserId(User)" />
                            <input type="hidden" name="CompanyId" value="@Model.CompanyId" />
                            <button type="submit" class="btn btn-outline-danger w-100">Huỷ Theo Dõi</button>
                        </form>
                      
                    }
                    else
                    {
                        <form method="POST" asp-action="Follow" asp-area="Companies" asp-controller="Company">
                            <input type="hidden" name="UserId" value="@UserManager.GetUserId(User)" />
                            <input type="hidden" name="CompanyId" value="@Model.CompanyId" />
                            <button type="submit" class="btn btn-outline-primary w-100">Theo Dõi</button>
                        </form>
                       
                    }
                   
                    <button class="mt-2 btn btn-primary w-100">Chia Sẻ<i class="ml-2 fas fa-share-alt"></i></button>

                </div>
            </div>
        </div>
    </div>
}
<div class="row p-4 mt-4 bg-light mb-4 rounded">
    <h4 class="font-weight-bold w-100 border-bottom pb-2">Giới thiệu doanh nghiệp</h4>
    <p>
       @Html.Raw(@Model.Description)
    </p>
</div>

<div class="row bg-light p-4">
    <div class="col">
        <h4 class="font-weight-bold w-100 border-bottom pb-2">Thông Tin Chung</h4>
        <div class="row  border-bottom">
            <div class="col-sm-4 py-2 d-flex align-items-center">
                <div class="mr-3" style="font-size: 1.3rem;">
                    <i class="fas fa-building mr-2"></i>
                </div>

                <div class="">
                    <div>Nơi Làm Việc</div>
                    <div>@Model.WorkingTime</div>
                </div>
            </div>
            <div class="col-sm-4  d-flex align-items-center">
                <div class="mr-3 " style="font-size: 1.3rem;">
                    <i class="fas fa-hourglass-half mr-2"></i>
                </div>
                <div class="">
                    <div>Làm việc ngoài giờ</div>
                    <div>@Model.OverTime</div>
                </div>
            </div>
        </div>
        <div class="row border-bottom">
            <div class="col-sm-4 py-2 d-flex align-items-center">
                <div class="mr-3" style="font-size: 1.3rem;">
                    <i class="fas fa-code mr-2"></i>
                </div>

                <div class="">
                    <div>Mô hình công ty</div>
                    <div>@Model.Type</div>
                </div>
            </div>
            <div class="col-sm-4  d-flex align-items-center">
                <div class="mr-3 " style="font-size: 1.3rem;">
                    <i class="fas fa-sitemap mr-2"></i>
                </div>
                <div class="">
                    <div>Quy mô công ty</div>
                    <div>@Model.Size</div>
                </div>
            </div>
        </div>
        <div class="row border-bottom">
            <div class="col-sm-4 py-2 d-flex align-items-center">
                <div class="mr-3" style="font-size: 1.3rem;">
                    <i class="fas fa-globe mr-2"></i>
                </div>

                <div class="">
                    <div>Quốc gia</div>
                    <div>@Model.Nation</div>
                </div>
            </div>
            <div class="col-sm-4  d-flex align-items-center">
                <div class="mr-3 " style="font-size: 1.3rem;">
                    <i class="fas fa-clock mr-2"></i>
                </div>
                <div class="">
                    <div>Thời gian làm việc</div>
                    <div>@Model.WorkingTime</div>
                </div>
            </div>
        </div>
   

    </div>
</div>




<div class="row my-4 bg-light p-4">
    <h4 class="font-weight-bold w-100 border-bottom pb-2">Kĩ Năng</h4>
    <p>
        @if (Model.CompanySkills.Any())
        {
            foreach (var t in Model.CompanySkills)
            {
                <span class="badge p-2 rounded-pill bg-light border m-1">@t.Skill.Name</span>
            }
        }
    </p>
</div>
<div class="row my-4 bg-light p-4">
    <h4 class="font-weight-bold w-100 border-bottom pb-2">Lý do bạn tham gia cùng chúng tôi</h4>
    <p>
        @Html.Raw(Model.Reason)
    </p>
</div>
<div class="row my-4 bg-light p-4">
    <h4 class="font-weight-bold w-100 border-bottom pb-2">Mô tả</h4>
    <p>
        @Html.Raw(Model.Description)
    </p>
</div>
@{
    List<Post> posts = Model.Posts.ToList();
}
<div class="row border bg-light mt-4 rounded">
    <div class="col">
        <h4 class="ml-3 font-weight-bold py-3">Vị trí đang tuyển (@posts.Count() Việc làm)</h4>
        <div class="row">
            @{
                foreach (var post in posts)
                {
                    <div class="col-sm-6 col-lg-3 mb-4">
                        <div class="card shadow  p-3 position-relative">
                            <h6 class="text-muted">Đăng 12 giờ trước</h6>
                            <h5>
                                <a asp-route-id="@post.PostId" asp-action="ViewPost" class="card-title">@post.Title</a>
                            </h5>
                            <div class="d-flex align-items-center mt-3" style="color: #008563 !important">
                                <h6 class="mr-2"><i class="fas fa-dollar-sign"></i></h6>
                                <h6>Lương: @post.salaryToString()</h6>
                            </div>
                            <hr />
                            <div class="d-flex align-items-center">
                                <span class="mr-2"><i class="fas fa-building"></i></span>
                                <span>@post.WorkSpace</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <span class="mr-2"><i class="fas fa-map-marker-alt"></i></span>
                                <span>Ho Chi Minh</span>
                            </div>
                            <div class="my-3">
                                @if (post.PostSkills.Any())
                                {
                                    foreach (var s in post.PostSkills)
                                    {
                                        <span class="badge p-2 rounded-pill bg-light border m-1">@s.Skill.Name</span>

                                    }
                                }
                            </div>
                        </div>
                        @if (post.IsHot)
                        {
                            <div class="ilabel position-absolute bg-danger py-1 px-2 text-white rounded-left" style="top: 10px; right: 0;width: 100px;">
                                <i class="fas fa-burn mr-2"></i>HOT
                            </div>
                        }
                    </div>
                }
            }

        </div>
    </div>
</div>
<div class="row mt-3">
    @if (Model.Addresses.Any())
    {
        string ggMapSrc = Model.Addresses.First().GgMapSrc;
        <div class="col-sm-4">

            @foreach (var address in Model.Addresses)
            {
                <div class="btn-address d-flex rounded border  p-3 mb-3 align-items-center" data-ggmap="@address.GgMapSrc">
                    <i class="fs4 fas fa-map-marker-alt mr-2 text-danger"></i>

                    <div class=" text-center ">@address.FullAddress</div>
                </div>
            }

        </div>
        <div class="col-sm-8">
            <iframe id="ggmap" style="height:500px;width:100%;border:0; border-radius: 0.8rem" frameborder="0"
                    src="@ggMapSrc">
            </iframe>

        </div>
    }
</div>
@section Scripts {
    <script type="text/javascript">

        $(document).ready(function () {
            function removeClassBtn() {
                $(".btn-address").each(function (index, el) {
                    $(el).removeClass("border-danger");
                })
            }
            $(".btn-address").each(function (index, el) {
                $(el).click(function (e) {
                    $("iframe#ggmap").attr("src", $(el)[0].dataset.ggmap);
                    removeClassBtn();
                    console.log($(e)[0])
                    $(el).addClass("border-danger");
                })
            })


        })

    </script>
}